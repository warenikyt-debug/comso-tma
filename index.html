<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå –ú–ï–¢–ï–û–†–ò–¢–ù–´–ô –ú–Ø–¢–ï–ñ v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            touch-action: manipulation;
        }

        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', 'Segoe UI', sans-serif;
            overflow: hidden;
            height: 100vh;
            cursor: crosshair;
        }

        #gameContainer {
            width: 100%;
            height: 100%;
            position: relative;
            background: #000;
        }

        canvas {
            display: block;
            background: #000;
            image-rendering: crisp-edges;
        }

        /* ===== –ù–û–í–´–ï –°–¢–ò–õ–ò –≠–ö–†–ê–ù–û–í ===== */
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, #330033 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, #003333 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, #000033 0%, #000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
            padding: 20px;
            animation: nebulaPulse 15s infinite alternate;
        }

        @keyframes nebulaPulse {
            0% { background-size: 100% 100%, 100% 100%, 100% 100%; }
            50% { background-size: 120% 120%, 120% 120%, 110% 110%; }
            100% { background-size: 100% 100%, 100% 100%, 100% 100%; }
        }

        .title {
            color: #ff00ff;
            font-size: clamp(32px, 6vw, 64px);
            margin-bottom: 10px;
            text-shadow: 
                0 0 10px #ff00ff,
                0 0 20px #ff00ff,
                0 0 40px #ff00ff;
            animation: glitch 3s infinite, titleFloat 6s infinite ease-in-out;
            letter-spacing: 2px;
            font-weight: 900;
            text-transform: uppercase;
        }

        .subtitle {
            color: #00ffff;
            font-size: clamp(18px, 3vw, 32px);
            margin-bottom: 30px;
            text-shadow: 0 0 15px #00ffff;
            animation: subtitleFloat 8s infinite ease-in-out;
        }

        @keyframes glitch {
            0%, 100% { 
                transform: translate(0, 0) skew(0deg); 
                clip-path: inset(0 0 0 0);
            }
            2% { 
                transform: translate(-2px, 2px) skew(2deg); 
                clip-path: inset(20% 0 60% 0);
            }
            4% { 
                transform: translate(2px, -2px) skew(-2deg); 
                clip-path: inset(80% 0 20% 0);
            }
            6% { 
                transform: translate(-1px, -1px) skew(1deg); 
                clip-path: inset(0 0 0 0);
            }
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.02); }
        }

        @keyframes subtitleFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(0.5deg); }
            75% { transform: translateY(5px) rotate(-0.5deg); }
        }

        button {
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff);
            background-size: 300% 300%;
            color: #000;
            border: none;
            padding: 18px 45px;
            font-size: clamp(16px, 2.5vw, 24px);
            border-radius: 50px;
            cursor: pointer;
            margin: 15px;
            font-weight: bold;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            animation: gradientShift 3s infinite alternate;
            box-shadow: 
                0 5px 15px rgba(255, 0, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        button:hover {
            transform: scale(1.15) rotate(2deg);
            box-shadow: 
                0 10px 30px rgba(255, 0, 255, 0.6),
                0 0 50px rgba(0, 255, 255, 0.4);
            animation: gradientShift 1s infinite alternate;
        }

        button:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }

        button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: conic-gradient(
                from 0deg,
                transparent,
                rgba(255, 0, 255, 0.3),
                rgba(0, 255, 255, 0.3),
                transparent
            );
            animation: rotate 4s linear infinite;
            z-index: -1;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ===== –ù–û–í–´–ô –ò–ù–¢–ï–†–§–ï–ô–° –ò–ì–†–´ ===== */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #ffff00;
            font-size: clamp(16px, 2vw, 24px);
            font-weight: bold;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px 25px;
            border-radius: 15px;
            border: 3px solid #ffff00;
            z-index: 150;
            box-shadow: 
                0 0 20px #ffff00,
                inset 0 0 10px rgba(255, 255, 0, 0.2);
            backdrop-filter: blur(10px);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            min-width: 300px;
        }

        #bossHealth {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: min(80%, 600px);
            height: 35px;
            background: rgba(0, 0, 0, 0.85);
            border: 3px solid #ff0000;
            border-radius: 20px;
            z-index: 150;
            overflow: hidden;
            box-shadow: 
                0 0 25px #ff0000,
                inset 0 0 15px rgba(255, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        #bossHealthFill {
            height: 100%;
            background: linear-gradient(90deg, 
                #ff0000 0%, 
                #ff5500 25%, 
                #ffff00 50%, 
                #ff5500 75%, 
                #ff0000 100%);
            background-size: 200% 100%;
            width: 100%;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: healthShimmer 2s infinite linear;
            position: relative;
            overflow: hidden;
        }

        @keyframes healthShimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        #bossHealthFill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 100%
            );
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        #bossHealthText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-weight: bold;
            text-shadow: 
                0 0 5px #000,
                0 0 10px #ff0000;
            font-size: clamp(14px, 1.5vw, 20px);
            letter-spacing: 1px;
        }

        #abilities {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 150;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 0, 0.3);
        }

        .abilityBtn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            border: 3px solid #ffff00;
            color: #000;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-weight: bold;
            box-shadow: 
                0 0 20px rgba(255, 255, 0, 0.5),
                inset 0 0 10px rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .abilityBtn:hover:not(.disabled) {
            transform: scale(1.15) rotate(15deg);
            box-shadow: 
                0 0 30px rgba(255, 255, 0, 0.8),
                0 0 40px rgba(255, 0, 255, 0.4);
        }

        .abilityBtn:active:not(.disabled) {
            transform: scale(0.9);
        }

        .abilityBtn.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(0.8);
        }

        .abilityBtn.cooldown {
            position: relative;
        }

        .abilityBtn.cooldown::after {
            content: attr(data-cooldown);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 24px;
            font-weight: bold;
            z-index: 2;
        }

        .abilityTooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            border: 2px solid #ffff00;
            z-index: 200;
        }

        .abilityBtn:hover .abilityTooltip {
            opacity: 1;
        }

        /* ===== –ù–û–í–´–ï –í–ò–ó–£–ê–õ–¨–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´ ===== */
        #meteorCount {
            position: absolute;
            top: 100px;
            left: 20px;
            color: #00ff00;
            font-size: clamp(14px, 1.8vw, 22px);
            background: rgba(0, 0, 0, 0.85);
            padding: 12px 24px;
            border-radius: 12px;
            border: 2px solid #00ff00;
            box-shadow: 0 0 15px #00ff00;
            backdrop-filter: blur(10px);
        }

        .phaseIndicator {
            position: absolute;
            bottom: 100px;
            right: 20px;
            color: #ff00ff;
            font-size: clamp(14px, 1.8vw, 22px);
            background: rgba(0, 0, 0, 0.85);
            padding: 12px 24px;
            border-radius: 12px;
            border: 2px solid #ff00ff;
            box-shadow: 0 0 15px #ff00ff;
            backdrop-filter: blur(10px);
            animation: phasePulse 2s infinite;
        }

        @keyframes phasePulse {
            0%, 100% { box-shadow: 0 0 15px #ff00ff; }
            50% { box-shadow: 0 0 25px #ff00ff, 0 0 40px #ff00ff; }
        }

        .comboCounter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 72px;
            font-weight: 900;
            color: #ffff00;
            text-shadow: 
                0 0 10px #ffff00,
                0 0 20px #ffff00,
                0 0 40px #ff5500;
            opacity: 0;
            pointer-events: none;
            z-index: 160;
            animation: comboPop 1s forwards;
        }

        @keyframes comboPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }

        .damageNumber {
            position: absolute;
            color: #ff5555;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 
                0 0 5px #000,
                0 0 10px #ff0000;
            pointer-events: none;
            z-index: 155;
            animation: damageFloat 1.5s forwards;
        }

        @keyframes damageFloat {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        #energyBar {
            position: absolute;
            bottom: 120px;
            left: 20px;
            width: 200px;
            height: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            border: 2px solid #00ffff;
            overflow: hidden;
            box-shadow: 0 0 10px #00ffff;
        }

        #energyFill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #0088ff);
            width: 0%;
            transition: width 0.3s;
        }

        #energyText {
            position: absolute;
            top: -25px;
            left: 0;
            color: #00ffff;
            font-size: 16px;
            font-weight: bold;
        }

        /* ===== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø ===== */
        @media (max-width: 768px) {
            #hud {
                grid-template-columns: 1fr;
                min-width: 200px;
                padding: 10px 15px;
            }
            
            #abilities {
                bottom: 10px;
                padding: 10px;
                gap: 10px;
            }
            
            .abilityBtn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            #meteorCount,
            .phaseIndicator {
                font-size: 14px;
                padding: 8px 16px;
            }
            
            #energyBar {
                bottom: 80px;
                width: 150px;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 14px;
            }
            
            button {
                padding: 12px 30px;
                font-size: 14px;
            }
            
            #abilities {
                gap: 8px;
            }
            
            .abilityBtn {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
        }

        /* ===== –ê–ù–ò–ú–ê–¶–ò–ò –î–õ–Ø –≠–§–§–ï–ö–¢–û–í ===== */
        @keyframes particleExplode {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        @keyframes shieldPulse {
            0%, 100% { box-shadow: 0 0 20px #00ffff; }
            50% { box-shadow: 0 0 40px #00ffff, 0 0 60px #00ffff; }
        }

        @keyframes teleportFlash {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù -->
        <div id="startScreen">
            <h1 class="title">üåå –ú–ï–¢–ï–û–†–ò–¢–ù–´–ô –ú–Ø–¢–ï–ñ</h1>
            <h2 class="subtitle">–¢–´ - –ú–ï–¢–ï–û–†–ò–¢. –£–ë–ï–ô –ë–û–°–°–ê-–ö–û–†–ê–ë–õ–¨!</h2>
            
            <div style="max-width: 800px; margin: 20px auto; padding: 20px;">
                <div style="
                    background: linear-gradient(135deg, 
                        rgba(255, 0, 255, 0.1), 
                        rgba(0, 255, 255, 0.1));
                    padding: 25px;
                    border-radius: 20px;
                    border: 2px solid #00ffff;
                    box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
                    text-align: left;
                    margin-bottom: 30px;
                ">
                    <h3 style="color: #ffff00; text-align: center; margin-bottom: 20px; font-size: 24px;">
                        üöÄ –ê–ë–°–û–õ–Æ–¢–ù–û –ù–ï–õ–û–ì–ò–ß–ù–´–ï –ü–†–ê–í–ò–õ–ê
                    </h3>
                    <div style="
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 15px;
                    ">
                        <div style="color: #fff; padding: 10px; border-left: 3px solid #ff00ff;">
                            <strong style="color: #ff00ff;">–¢—ã –Ω–µ –∫–æ—Ä–∞–±–ª—å</strong><br>
                            –¢—ã - –ú–ï–¢–ï–û–†–ò–¢ (–∏—Ö –º–Ω–æ–≥–æ)
                        </div>
                        <div style="color: #fff; padding: 10px; border-left: 3px solid #00ffff;">
                            <strong style="color: #00ffff;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–æ–π</strong><br>
                            –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π –≤—Å–µ—Ö –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤ —Å—Ä–∞–∑—É
                        </div>
                        <div style="color: #fff; padding: 10px; border-left: 3px solid #ffff00;">
                            <strong style="color: #ffff00;">–¢–∞–ø–∞–π –∏ –∫—Ä—É—à–∏</strong><br>
                            –ö–ª–∏–∫–∞–π –ø–æ —ç–∫—Ä–∞–Ω—É - –º–µ—Ç–µ–æ—Ä–∏—Ç—ã –ª–µ—Ç—è—Ç —Ç—É–¥–∞
                        </div>
                        <div style="color: #fff; padding: 10px; border-left: 3px solid #ff5500;">
                            <strong style="color: #ff5500;">–ë–µ–∑—É–º–Ω—ã–π –±–æ—Å—Å</strong><br>
                            –°—Ç—Ä–µ–ª—è–µ—Ç, —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è, –º–µ–Ω—è–µ—Ç —Ñ–∞–∑—ã
                        </div>
                    </div>
                </div>
                
                <div style="
                    background: rgba(255, 255, 0, 0.1);
                    padding: 15px;
                    border-radius: 15px;
                    border: 2px dashed #ffff00;
                    margin-bottom: 30px;
                ">
                    <p style="color: #ffff00; text-align: center; font-size: 18px;">
                        üíé –°–æ–±–µ—Ä–∏ 50 —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –ú–ï–¢–ï–û–†–ò–¢–ù–û–ì–û –®–û–ö–ï–†–ê!
                    </p>
                </div>
            </div>
            
            <button id="startBtn">üöÄ –ù–ê–ß–ê–¢–¨ –ë–ï–ó–£–ú–ò–ï</button>
            <button id="helpBtn" style="background: linear-gradient(45deg, #ffff00, #ff5500);">
                ‚ùì –ö–ê–ö –ò–ì–†–ê–¢–¨
            </button>
        </div>
        
        <!-- –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù -->
        <div id="gameScreen" style="display: none;">
            <canvas id="gameCanvas"></canvas>
            
            <div id="hud">
                <div>–£–Ω–∏—á—Ç–æ–∂–µ–Ω–æ: <span id="meteorsDestroyed" style="color: #ff5555;">0</span></div>
                <div>–§–∞–∑–∞: <span id="phaseNumber" style="color: #ff00ff;">1</span></div>
            </div>
            
            <div id="bossHealth">
                <div id="bossHealthFill"></div>
                <div id="bossHealthText">–ë–û–°–°: <span id="bossHealthPercent">100</span>%</div>
            </div>
            
            <div id="meteorCount">‚òÑÔ∏è <span id="meteorCountNum">0</span></div>
            
            <div class="phaseIndicator">‚ö° –§–ê–ó–ê –ë–ï–ó–£–ú–ò–Ø: <span id="phaseDisplay">1</span></div>
            
            <div id="energyBar">
                <div id="energyFill"></div>
                <div id="energyText">–≠–ù–ï–†–ì–ò–Ø: <span id="energyValue">0</span>/50</div>
            </div>
            
            <div id="abilities">
                <button class="abilityBtn" id="ability1" data-cost="10">
                    üå™Ô∏è
                    <div class="abilityTooltip">–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞<br>–°—Ç–æ–∏–º–æ—Å—Ç—å: 10 —ç–Ω–µ—Ä–≥–∏–∏</div>
                </button>
                <button class="abilityBtn" id="ability2" data-cost="50">
                    ‚ö°
                    <div class="abilityTooltip">–ú–µ—Ç–µ–æ—Ä–∏—Ç–Ω—ã–π —à–æ–∫–µ—Ä<br>–°—Ç–æ–∏–º–æ—Å—Ç—å: 50 —ç–Ω–µ—Ä–≥–∏–∏</div>
                </button>
                <button class="abilityBtn" id="ability3" data-cost="0">
                    ‚ú®
                    <div class="abilityTooltip">–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è<br>–ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞: 5—Å</div>
                </button>
                <button class="abilityBtn" id="ability4" data-cost="30">
                    ‚ùÑÔ∏è
                    <div class="abilityTooltip">–í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–º–æ—Ä–æ–∑–∫–∞<br>–°—Ç–æ–∏–º–æ—Å—Ç—å: 30 —ç–Ω–µ—Ä–≥–∏–∏</div>
                </button>
            </div>
        </div>
        
        <!-- –≠–ö–†–ê–ù –ó–ê–í–ï–†–®–ï–ù–ò–Ø -->
        <div id="gameOverScreen" style="
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(0, 0, 50, 0.95) 0%, rgba(0, 0, 0, 0.98) 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            text-align: center;
        ">
            <h1 class="title" id="gameOverTitle">–ö–û–ù–ï–¶ –ò–ì–†–´</h1>
            <div style="
                background: rgba(255, 255, 0, 0.1);
                padding: 30px;
                border-radius: 20px;
                border: 2px solid #ffff00;
                margin: 30px 0;
                min-width: 400px;
            ">
                <h2 class="subtitle" style="color: #ff5555; margin-bottom: 15px;">
                    –£–ù–ò–ß–¢–û–ñ–ï–ù–û: <span id="finalMeteors">0</span> –ú–ï–¢–ï–û–†–ò–¢–û–í
                </h2>
                <h2 class="subtitle" style="color: #00ffff; margin-bottom: 15px;">
                    –í–†–ï–ú–Ø: <span id="finalTime">0</span> –°–ï–ö–£–ù–î
                </h2>
                <h2 class="subtitle" style="color: #ff00ff;">
                    –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –§–ê–ó–ê: <span id="finalPhase">1</span>
                </h2>
            </div>
            
            <div style="display: flex; gap: 20px; margin-top: 30px;">
                <button id="restartBtn">üîÑ –ï–©–Å –†–ê–ó</button>
                <button id="menuBtn">üè† –í –ú–ï–ù–Æ</button>
            </div>
        </div>
        
        <!-- –ë–û–°–°-–ò–ù–¢–†–û -->
        <div id="bossIntro" style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 25px;
            border: 4px solid #ff0000;
            box-shadow: 0 0 50px #ff0000;
            z-index: 180;
            display: none;
            text-align: center;
            min-width: 400px;
        ">
            <h2 style="color: #ff0000; font-size: 32px; margin-bottom: 20px;">üö® –í–ù–ò–ú–ê–ù–ò–ï! üö®</h2>
            <p style="color: #fff; font-size: 24px; margin-bottom: 30px;">
                –ü–æ—è–≤–∏–ª—Å—è <span id="bossName" style="color: #ff00ff;">–ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –¢–ò–†–ê–ù</span>!
            </p>
            <p style="color: #ffff00; font-size: 18px; margin-bottom: 20px;">
                –£–Ω–∏—á—Ç–æ–∂—å—Ç–µ –µ–≥–æ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω —É–Ω–∏—á—Ç–æ–∂–∏—Ç –≤–∞—Å!
            </p>
            <div style="
                background: rgba(255, 0, 0, 0.2);
                padding: 15px;
                border-radius: 10px;
                margin-top: 20px;
            ">
                <p style="color: #ffaaaa; font-size: 14px;">
                    ‚ö° 3 —Ñ–∞–∑—ã –±–µ–∑—É–º–∏—è<br>
                    üõ°Ô∏è –©–∏—Ç—ã –∏ —Ç–µ–ª–µ–ø–æ—Ä—Ç—ã<br>
                    üí• –û—Å–æ–±—ã–µ –∞—Ç–∞–∫–∏
                </p>
            </div>
        </div>
    </div>

    <script>
        // ===== –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d', { alpha: false });
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const bossIntro = document.getElementById('bossIntro');
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let game = {
            running: false,
            score: 0,
            meteorsDestroyed: 0,
            energy: 0,
            maxEnergy: 50,
            phase: 1,
            phaseTimer: 0,
            gameTime: 0,
            bossHealth: 1000,
            maxBossHealth: 1000,
            bossActive: false,
            combo: 0,
            comboMultiplier: 1,
            comboTime: 0,
            highScore: localStorage.getItem('meteorHighScore') || 0,
            
            // –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
            abilities: {
                gravity: { cooldown: 0, cost: 10 },
                shocker: { cooldown: 0, cost: 50 },
                teleport: { cooldown: 0, cost: 0 },
                freeze: { cooldown: 0, cost: 30 }
            }
        };

        // –ò–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
        let meteors = [];
        let boss = null;
        let bossBullets = [];
        let particles = [];
        let effects = [];
        let stars = [];
        let damageNumbers = [];

        // ===== –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò =====

        function initGame() {
            console.log('üöÄ –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã...');
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            game.running = true;
            game.score = 0;
            game.meteorsDestroyed = 0;
            game.energy = 0;
            game.phase = 1;
            game.phaseTimer = 0;
            game.gameTime = 0;
            game.bossHealth = 1000;
            game.bossActive = true;
            game.combo = 0;
            game.comboMultiplier = 1;
            
            // –û—á–∏—Å—Ç–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤
            meteors = [];
            bossBullets = [];
            particles = [];
            effects = [];
            damageNumbers = [];
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ canvas
            setupCanvas();
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—ë–∑–¥–Ω–æ–≥–æ –ø–æ–ª—è
            createStars();
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤
            for (let i = 0; i < 20; i++) {
                createMeteor(true);
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Å—Å–∞
            createBoss();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateUI();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ç—Ä–æ –±–æ—Å—Å–∞
            showBossIntro();
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            requestAnimationFrame(gameLoop);
            
            console.log('‚úÖ –ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞!');
        }

        function createStars() {
            stars = [];
            const starCount = Math.min(500, Math.floor((canvas.width * canvas.height) / 1000));
            
            for (let i = 0; i < starCount; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 3 + 1,
                    speed: Math.random() * 0.5 + 0.1,
                    color: Math.random() > 0.7 ? '#ffffff' : 
                           Math.random() > 0.5 ? '#aaffff' : '#ffaaff',
                    twinkle: Math.random() * Math.PI * 2,
                    brightness: Math.random() * 0.8 + 0.2
                });
            }
        }

        function createMeteor(randomPos = false) {
            const types = [
                { 
                    size: 25, 
                    color: '#ff5555', 
                    speed: 3, 
                    health: 2,
                    value: 10,
                    name: '–ö—Ä–∞—Å–Ω—ã–π –º–µ—Ç–µ–æ—Ä–∏—Ç'
                },
                { 
                    size: 35, 
                    color: '#ffaa00', 
                    speed: 2, 
                    health: 3,
                    value: 20,
                    name: '–û—Ä–∞–Ω–∂–µ–≤—ã–π –º–µ—Ç–µ–æ—Ä–∏—Ç'
                },
                { 
                    size: 45, 
                    color: '#ffff55', 
                    speed: 1.5, 
                    health: 5,
                    value: 30,
                    name: '–ñ—ë–ª—Ç—ã–π –º–µ—Ç–µ–æ—Ä–∏—Ç'
                },
                { 
                    size: 20, 
                    color: '#00ffff', 
                    speed: 4, 
                    health: 1,
                    value: 50,
                    name: '–¶–∏–∞–Ω–æ–≤—ã–π –º–µ—Ç–µ–æ—Ä–∏—Ç'
                }
            ];
            
            const type = types[Math.floor(Math.random() * types.length)];
            
            let x, y;
            if (randomPos) {
                x = Math.random() * canvas.width;
                y = Math.random() * canvas.height;
            } else {
                const side = Math.floor(Math.random() * 4);
                const padding = 100;
                
                switch(side) {
                    case 0: // –≤–µ—Ä—Ö
                        x = Math.random() * canvas.width;
                        y = -type.size - padding;
                        break;
                    case 1: // –ø—Ä–∞–≤–æ
                        x = canvas.width + type.size + padding;
                        y = Math.random() * canvas.height;
                        break;
                    case 2: // –Ω–∏–∑
                        x = Math.random() * canvas.width;
                        y = canvas.height + type.size + padding;
                        break;
                    case 3: // –ª–µ–≤–æ
                        x = -type.size - padding;
                        y = Math.random() * canvas.height;
                        break;
                }
            }
            
            const meteor = {
                id: Date.now() + Math.random(),
                x: x,
                y: y,
                size: type.size,
                color: type.color,
                speed: type.speed,
                health: type.health,
                maxHealth: type.health,
                value: type.value,
                name: type.name,
                targetX: Math.random() * canvas.width,
                targetY: Math.random() * canvas.height,
                rotation: Math.random() * Math.PI * 2,
                rotationSpeed: (Math.random() - 0.5) * 0.1,
                trail: [],
                isBossMeteor: false,
                lastHit: 0
            };
            
            meteors.push(meteor);
            return meteor;
        }

        function createBoss() {
            const bossNames = [
                "–ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –¢–ò–†–ê–ù",
                "–ì–ê–õ–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –£–ì–ù–ï–¢–ê–¢–ï–õ–¨",
                "–í–°–ï–õ–ï–ù–°–ö–ò–ô –î–ï–°–ü–û–¢",
                "–ú–ï–ñ–ó–í–Å–ó–î–ù–´–ô –î–ò–ö–¢–ê–¢–û–†"
            ];
            
            boss = {
                x: canvas.width / 2,
                y: 150,
                width: 150,
                height: 100,
                name: bossNames[Math.floor(Math.random() * bossNames.length)],
                color: '#ff00ff',
                health: game.maxBossHealth,
                maxHealth: game.maxBossHealth,
                phase: 1,
                attackTimer: 0,
                teleportTimer: 0,
                shieldTimer: 0,
                spawnTimer: 0,
                direction: 1,
                speed: 1.5,
                shield: false,
                isTeleporting: false,
                attackPattern: 'normal',
                specialAttackCooldown: 0
            };
            
            document.getElementById('bossName').textContent = boss.name;
        }

        // ===== –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –û–¢–†–ò–°–û–í–ö–ò =====

        function drawBackground() {
            // –ß—ë—Ä–Ω—ã–π —Ñ–æ–Ω —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#000011');
            gradient.addColorStop(1, '#000022');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –¢—É–º–∞–Ω–Ω–æ—Å—Ç–∏
            if (game.phase > 1) {
                drawNebulas();
            }
            
            // –ó–≤—ë–∑–¥—ã
            drawStars();
            
            // –°—Ç—Ä–∞–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏ –ø—Ä–∏ –≤—ã—Å–æ–∫–∏—Ö —Ñ–∞–∑–∞—Ö
            if (game.phase >= 3) {
                drawPhaseEffects();
            }
        }

        function drawNebulas() {
            // –¢—É–º–∞–Ω–Ω–æ—Å—Ç—å 1 (—Ä–æ–∑–æ–≤–∞—è)
            const nebula1 = ctx.createRadialGradient(
                canvas.width * 0.2, canvas.height * 0.3, 0,
                canvas.width * 0.2, canvas.height * 0.3, 300
            );
            nebula1.addColorStop(0, 'rgba(255, 0, 255, 0.1)');
            nebula1.addColorStop(1, 'rgba(255, 0, 255, 0)');
            ctx.fillStyle = nebula1;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –¢—É–º–∞–Ω–Ω–æ—Å—Ç—å 2 (—Å–∏–Ω—è—è)
            const nebula2 = ctx.createRadialGradient(
                canvas.width * 0.8, canvas.height * 0.7, 0,
                canvas.width * 0.8, canvas.height * 0.7, 250
            );
            nebula2.addColorStop(0, 'rgba(0, 255, 255, 0.08)');
            nebula2.addColorStop(1, 'rgba(0, 255, 255, 0)');
            ctx.fillStyle = nebula2;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawStars() {
            stars.forEach(star => {
                // –ú–µ—Ä—Ü–∞–Ω–∏–µ
                const twinkle = Math.sin(Date.now() / 1000 + star.twinkle) * 0.3 + 0.7;
                const brightness = star.brightness * twinkle;
                
                // –¶–≤–µ—Ç –∑–≤–µ–∑–¥—ã
                ctx.fillStyle = star.color.replace(')', `, ${brightness})`).replace('rgb', 'rgba');
                
                // –†–∏—Å—É–µ–º –∑–≤–µ–∑–¥—É
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
                
                // –ë–æ–ª—å—à–∏–µ –∑–≤—ë–∑–¥—ã –ø–æ–ª—É—á–∞—é—Ç —Å–≤–µ—á–µ–Ω–∏–µ
                if (star.size > 2) {
                    ctx.shadowColor = star.color;
                    ctx.shadowBlur = star.size * 3;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            });
        }

        function drawPhaseEffects() {
            // –ò—Å–∫–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞-–≤—Ä–µ–º–µ–Ω–∏
            ctx.strokeStyle = `rgba(255, 0, 255, ${0.1 + Math.sin(Date.now() / 1000) * 0.1})`;
            ctx.lineWidth = 1;
            
            for (let i = 0; i < 20; i++) {
                const y = (canvas.height / 20) * i;
                const wave = Math.sin(Date.now() / 500 + i) * 30;
                
                ctx.beginPath();
                ctx.moveTo(0, y + wave);
                for (let x = 0; x < canvas.width; x += 50) {
                    const segmentWave = Math.sin(Date.now() / 300 + x / 100 + i) * 20;
                    ctx.lineTo(x, y + wave + segmentWave);
                }
                ctx.stroke();
            }
        }

        function drawMeteors() {
            meteors.forEach(meteor => {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–µ–¥–∞
                meteor.trail.push({ x: meteor.x, y: meteor.y, color: meteor.color });
                if (meteor.trail.length > 15) {
                    meteor.trail.shift();
                }
                
                // –†–∏—Å—É–µ–º —Å–ª–µ–¥
                meteor.trail.forEach((point, i) => {
                    const alpha = i / meteor.trail.length * 0.5;
                    const size = meteor.size * (i / meteor.trail.length);
                    
                    ctx.fillStyle = point.color.replace(')', `, ${alpha})`).replace('rgb', 'rgba');
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, size, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
                ctx.save();
                ctx.translate(meteor.x, meteor.y);
                ctx.rotate(meteor.rotation);
                
                // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞
                ctx.fillStyle = meteor.color;
                ctx.beginPath();
                
                // –ú–Ω–æ–≥–æ—É–≥–æ–ª—å–Ω–∏–∫ —Å —à—É–º–æ–º –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–∞–º–Ω—è
                const sides = 8;
                for (let i = 0; i < sides; i++) {
                    const angle = (i / sides) * Math.PI * 2;
                    const noise = 0.2 + Math.sin(i * 123.456) * 0.1;
                    const radius = meteor.size * (0.8 + noise);
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.fill();
                
                // –î–µ—Ç–∞–ª–∏ –∏ —Ç–µ–∫—Å—Ç—É—Ä–∞
                ctx.fillStyle = '#ffffff';
                for (let i = 0; i < 4; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * meteor.size * 0.6;
                    const size = Math.random() * meteor.size * 0.15 + 2;
                    
                    ctx.beginPath();
                    ctx.arc(
                        Math.cos(angle) * distance,
                        Math.sin(angle) * distance,
                        size, 0, Math.PI * 2
                    );
                    ctx.fill();
                }
                
                // –°–≤–µ—á–µ–Ω–∏–µ –¥–ª—è –æ—Å–æ–±—ã—Ö –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤
                if (meteor.value >= 30) {
                    ctx.shadowColor = meteor.color;
                    ctx.shadowBlur = 15;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
                
                ctx.restore();
                
                // –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
                if (meteor.health < meteor.maxHealth) {
                    drawHealthBar(meteor.x, meteor.y - meteor.size - 15, meteor.size * 2, 5, meteor.health / meteor.maxHealth);
                }
                
                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –±–æ—Å—Å–∞-–º–µ—Ç–µ–æ—Ä–∏—Ç–∞
                if (meteor.isBossMeteor) {
                    ctx.strokeStyle = '#ff00ff';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(meteor.x, meteor.y, meteor.size + 5, 0, Math.PI * 2);
                    ctx.stroke();
                }
            });
        }

        function drawBoss() {
            if (!boss || !game.bossActive) return;
            
            ctx.save();
            ctx.translate(boss.x, boss.y);
            
            // –©–∏—Ç –±–æ—Å—Å–∞
            if (boss.shield) {
                ctx.strokeStyle = '#00ffff';
                ctx.lineWidth = 4;
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.arc(0, 0, boss.width + 40, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // –≠—Ñ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü–∏–∏ —â–∏—Ç–∞
                ctx.shadowColor = '#00ffff';
                ctx.shadowBlur = 20;
                ctx.stroke();
                ctx.shadowBlur = 0;
            }
            
            // –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç
            if (boss.isTeleporting) {
                const teleportSize = boss.width * (1 + Math.sin(Date.now() / 100) * 0.5);
                ctx.strokeStyle = `rgba(255, 255, 0, ${0.5 + Math.sin(Date.now() / 50) * 0.5})`;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(0, 0, teleportSize, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ä–ø—É—Å
            const gradient = ctx.createLinearGradient(-boss.width/2, 0, boss.width/2, 0);
            gradient.addColorStop(0, '#ff00ff');
            gradient.addColorStop(0.5, '#ffffff');
            gradient.addColorStop(1, '#ff00ff');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            
            // –°–ª–æ–∂–Ω–∞—è —Ñ–æ—Ä–º–∞ –±–æ—Å—Å–∞
            ctx.moveTo(0, -boss.height/2);
            for (let i = 0; i < 16; i++) {
                const angle = (i / 16) * Math.PI * 2;
                const radius = i % 2 === 0 ? boss.width/2 : boss.width/3;
                const wave = Math.sin(Date.now() / 200 + i) * 5;
                const x = Math.cos(angle) * (radius + wave);
                const y = Math.sin(angle) * (radius + wave);
                
                ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.fill();
            
            // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
            ctx.fillStyle = '#000000';
            
            // –û—Ä—É–∂–∏—è (4 —à—Ç—É–∫–∏)
            for (let i = 0; i < 4; i++) {
                const angle = (i / 4) * Math.PI * 2 + Date.now() / 500;
                const x = Math.cos(angle) * (boss.width/2 + 10);
                const y = Math.sin(angle) * (boss.width/2 + 10);
                
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle);
                
                // –û—Å–Ω–æ–≤–∞ –æ—Ä—É–∂–∏—è
                ctx.fillStyle = '#333333';
                ctx.fillRect(-15, -8, 30, 16);
                
                // –û–≥–æ–Ω—å –ø—Ä–∏ –∞—Ç–∞–∫–µ
                if (boss.attackTimer > 50) {
                    ctx.fillStyle = '#ff0000';
                    ctx.fillRect(15, -6, 20, 12);
                }
                
                ctx.restore();
            }
            
            // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–µ–∞–∫—Ç–æ—Ä
            const reactorPulse = Math.sin(Date.now() / 200) * 0.2 + 0.8;
            ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            ctx.arc(0, 0, boss.width/4 * reactorPulse, 0, Math.PI * 2);
            ctx.fill();
            
            // –ì–ª–∞–∑–∞
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(-boss.width/4, -boss.height/4, 10, 0, Math.PI * 2);
            ctx.arc(boss.width/4, -boss.height/4, 10, 0, Math.PI * 2);
            ctx.fill();
            
            // –ó—Ä–∞—á–∫–∏ (—Å–ª–µ–∂–µ–Ω–∏–µ –∑–∞ –∏–≥—Ä–æ–∫–æ–º)
            const target = meteors[0] || { x: boss.x, y: boss.y };
            const lookAngle = Math.atan2(target.y - boss.y, target.x - boss.x);
            
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(
                -boss.width/4 + Math.cos(lookAngle) * 4,
                -boss.height/4 + Math.sin(lookAngle) * 4,
                5, 0, Math.PI * 2
            );
            ctx.arc(
                boss.width/4 + Math.cos(lookAngle) * 4,
                -boss.height/4 + Math.sin(lookAngle) * 4,
                5, 0, Math.PI * 2
            );
            ctx.fill();
            
            ctx.restore();
        }

        function drawBullets() {
            bossBullets.forEach(bullet => {
                ctx.save();
                ctx.translate(bullet.x, bullet.y);
                ctx.rotate(bullet.angle);
                
                // –§–æ—Ä–º–∞ –ø—É–ª–∏
                const gradient = ctx.createLinearGradient(0, -bullet.size, 0, bullet.size);
                gradient.addColorStop(0, bullet.color);
                gradient.addColorStop(0.5, '#ffffff');
                gradient.addColorStop(1, bullet.color);
                
                ctx.fillStyle = gradient;
                
                // –¢–∏–ø—ã –ø—É–ª—å
                switch(bullet.type) {
                    case 'spiral':
                        // –°–ø–∏—Ä–∞–ª—å–Ω–∞—è –ø—É–ª—è
                        ctx.beginPath();
                        for (let i = 0; i < 3; i++) {
                            const angle = (i / 3) * Math.PI * 2 + Date.now() / 50;
                            const x = Math.cos(angle) * bullet.size * 0.5;
                            const y = Math.sin(angle) * bullet.size * 0.5;
                            
                            if (i === 0) ctx.moveTo(x, y);
                            else ctx.lineTo(x, y);
                        }
                        ctx.closePath();
                        ctx.fill();
                        break;
                        
                    case 'homing':
                        // –°–∞–º–æ–Ω–∞–≤–æ–¥—è—â–∞—è—Å—è –ø—É–ª—è
                        ctx.beginPath();
                        ctx.moveTo(0, -bullet.size * 1.5);
                        ctx.lineTo(-bullet.size, bullet.size);
                        ctx.lineTo(0, bullet.size * 0.5);
                        ctx.lineTo(bullet.size, bullet.size);
                        ctx.closePath();
                        ctx.fill();
                        break;
                        
                    default:
                        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—É–ª—è
                        ctx.beginPath();
                        ctx.ellipse(0, 0, bullet.size, bullet.size/2, bullet.angle, 0, Math.PI * 2);
                        ctx.fill();
                }
                
                // –°–≤–µ—á–µ–Ω–∏–µ
                ctx.shadowColor = bullet.color;
                ctx.shadowBlur = 15;
                ctx.fill();
                ctx.shadowBlur = 0;
                
                // –°–ª–µ–¥ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—É–ª—å
                if (bullet.trail) {
                    ctx.fillStyle = bullet.color + '80';
                    ctx.beginPath();
                    ctx.arc(0, 0, bullet.size * 0.6, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                ctx.restore();
            });
        }

        function drawParticles() {
            particles.forEach(particle => {
                ctx.globalAlpha = particle.life / particle.maxLife;
                
                // –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —á–∞—Å—Ç–∏—Ü
                if (particle.type === 'spark') {
                    // –ò—Å–∫—Ä—ã
                    ctx.fillStyle = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                } else if (particle.type === 'trail') {
                    // –°–ª–µ–¥—ã
                    ctx.strokeStyle = particle.color;
                    ctx.lineWidth = particle.size;
                    ctx.beginPath();
                    ctx.moveTo(particle.x, particle.y);
                    ctx.lineTo(particle.x - particle.vx * 2, particle.y - particle.vy * 2);
                    ctx.stroke();
                } else {
                    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã
                    const gradient = ctx.createRadialGradient(
                        particle.x, particle.y, 0,
                        particle.x, particle.y, particle.size
                    );
                    gradient.addColorStop(0, particle.color);
                    gradient.addColorStop(1, particle.color + '00');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                ctx.globalAlpha = 1;
            });
        }

        function drawDamageNumbers() {
            damageNumbers.forEach(damage => {
                ctx.save();
                ctx.translate(damage.x, damage.y);
                
                ctx.fillStyle = damage.color;
                ctx.font = `bold ${damage.size}px Courier New`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = '#000000';
                ctx.shadowBlur = 3;
                
                ctx.fillText(damage.value.toString(), 0, 0);
                
                ctx.shadowBlur = 0;
                ctx.restore();
            });
        }

        function drawHealthBar(x, y, width, height, percent) {
            const barX = x - width / 2;
            const barY = y - height / 2;
            
            // –§–æ–Ω
            ctx.fillStyle = '#333333';
            ctx.fillRect(barX, barY, width, height);
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
            const fillWidth = width * percent;
            const gradient = ctx.createLinearGradient(barX, 0, barX + fillWidth, 0);
            
            if (percent > 0.5) {
                gradient.addColorStop(0, '#00ff00');
                gradient.addColorStop(1, '#ffff00');
            } else if (percent > 0.2) {
                gradient.addColorStop(0, '#ffff00');
                gradient.addColorStop(1, '#ff5500');
            } else {
                gradient.addColorStop(0, '#ff0000');
                gradient.addColorStop(1, '#ff5500');
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(barX, barY, fillWidth, height);
            
            // –†–∞–º–∫–∞
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 1;
            ctx.strokeRect(barX, barY, width, height);
        }

        function drawEffects() {
            effects.forEach(effect => {
                switch(effect.type) {
                    case 'gravity':
                        drawGravityField(effect);
                        break;
                    case 'explosion':
                        drawExplosion(effect);
                        break;
                    case 'shield':
                        drawShieldEffect(effect);
                        break;
                }
            });
        }

        function drawGravityField(effect) {
            const gradient = ctx.createRadialGradient(
                effect.x, effect.y, 0,
                effect.x, effect.y, effect.radius
            );
            gradient.addColorStop(0, 'rgba(0, 255, 255, 0.3)');
            gradient.addColorStop(0.5, 'rgba(0, 255, 255, 0.1)');
            gradient.addColorStop(1, 'rgba(0, 255, 255, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(effect.x, effect.y, effect.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // –°–ø–∏—Ä–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 2;
            for (let i = 0; i < 3; i++) {
                const startAngle = Date.now() / 1000 + i * Math.PI * 2/3;
                const endAngle = startAngle + Math.PI;
                
                ctx.beginPath();
                ctx.arc(effect.x, effect.y, effect.radius * 0.7, startAngle, endAngle);
                ctx.stroke();
            }
        }

        // ===== –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê =====

        function updateGame() {
            if (!game.running) return;
            
            const currentTime = Date.now();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            game.gameTime++;
            game.phaseTimer++;
            
            // –°–º–µ–Ω–∞ —Ñ–∞–∑—ã –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            if (game.phaseTimer > 1800) { // 30 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ 60 FPS
                game.phase = Math.min(3, game.phase + 1);
                game.phaseTimer = 0;
                phaseChanged();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–±–æ
            if (currentTime - game.comboTime > 2000) { // 2 —Å–µ–∫—É–Ω–¥—ã
                if (game.combo > 1) {
                    game.combo--;
                    game.comboMultiplier = 1 + (game.combo * 0.1);
                }
                game.comboTime = currentTime;
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–∏–∏
            if (game.energy < game.maxEnergy && game.gameTime % 60 === 0) {
                game.energy = Math.min(game.maxEnergy, game.energy + 1);
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
            updateMeteors();
            updateBoss();
            updateBullets();
            updateParticles();
            updateDamageNumbers();
            updateEffects();
            
            // –°–ª—É—á–∞–π–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤
            if (Math.random() < 0.02) {
                createMeteor();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–ª–¥–∞—É–Ω–æ–≤ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
            updateAbilityCooldowns();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateUI();
        }

        function updateMeteors() {
            for (let i = meteors.length - 1; i >= 0; i--) {
                const meteor = meteors[i];
                
                // –í—Ä–∞—â–µ–Ω–∏–µ
                meteor.rotation += meteor.rotationSpeed;
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–∏
                const dx = meteor.targetX - meteor.x;
                const dy = meteor.targetY - meteor.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 0) {
                    const speed = meteor.speed * (1 + game.phase * 0.1);
                    meteor.x += (dx / distance) * speed;
                    meteor.y += (dy / distance) * speed;
                }
                
                // –ù–æ–≤–∞—è —Ü–µ–ª—å –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –∏–ª–∏ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
                if (distance < 10 || game.gameTime % 120 === 0) {
                    meteor.targetX = Math.random() * canvas.width;
                    meteor.targetY = Math.random() * canvas.height;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å –ø—É–ª—è–º–∏
                for (let j = bossBullets.length - 1; j >= 0; j--) {
                    const bullet = bossBullets[j];
                    const bulletDx = meteor.x - bullet.x;
                    const bulletDy = meteor.y - bullet.y;
                    const bulletDistance = Math.sqrt(bulletDx * bulletDx + bulletDy * bulletDy);
                    
                    if (bulletDistance < meteor.size + bullet.size) {
                        meteorHit(meteor, bullet, i, j);
                        break;
                    }
                }
                
                // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –±–æ—Å—Å–æ–º
                if (boss && !boss.shield && game.bossActive) {
                    const bossDx = meteor.x - boss.x;
                    const bossDy = meteor.y - boss.y;
                    const bossDistance = Math.sqrt(bossDx * bossDx + bossDy * bossDy);
                    
                    if (bossDistance < meteor.size + boss.width/2) {
                        bossHit(meteor, i);
                    }
                }
                
                // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
                if (meteor.x < -200 || meteor.x > canvas.width + 200 ||
                    meteor.y < -200 || meteor.y > canvas.height + 200) {
                    meteors.splice(i, 1);
                }
            }
        }

        function meteorHit(meteor, bullet, meteorIndex, bulletIndex) {
            // –£—Ä–æ–Ω –º–µ—Ç–µ–æ—Ä–∏—Ç—É
            meteor.health--;
            meteor.lastHit = Date.now();
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
            createParticles(bullet.x, bullet.y, bullet.color, 8);
            
            // –ó–≤—É–∫–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç (–∑–∞–≥–ª—É—à–∫–∞)
            // playSound('hit');
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –ø—É–ª–∏
            bossBullets.splice(bulletIndex, 1);
            
            if (meteor.health <= 0) {
                // –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞
                const explosionSize = meteor.size * 2;
                createExplosion(meteor.x, meteor.y, meteor.color, explosionSize);
                
                // –ù–∞–≥—Ä–∞–¥–∞
                const value = meteor.value * game.comboMultiplier;
                game.score += Math.floor(value);
                game.meteorsDestroyed++;
                game.energy = Math.min(game.maxEnergy, game.energy + Math.floor(meteor.value / 10));
                
                // –ö–æ–º–±–æ
                game.combo++;
                game.comboMultiplier = 1 + (game.combo * 0.1);
                game.comboTime = Date.now();
                
                if (game.combo % 5 === 0) {
                    showCombo(game.combo);
                }
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —á–∏—Å–ª–∞ —É—Ä–æ–Ω–∞
                showDamageNumber(meteor.x, meteor.y, value, meteor.color);
                
                // –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞
                meteors.splice(meteorIndex, 1);
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞
                if (!meteor.isBossMeteor) {
                    setTimeout(() => createMeteor(), 500);
                }
                
                // –°—Ç—Ä–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤
                if (meteor.value >= 30) {
                    const messages = [
                        "–ú–û–©–ù–´–ô –£–î–ê–†!",
                        "–≠–ü–ò–ß–ù–û!",
                        "–ö–û–ú–ë–û x" + game.combo,
                        meteor.name.toUpperCase() + " –£–ù–ò–ß–¢–û–ñ–ï–ù!"
                    ];
                    showEffectMessage(
                        messages[Math.floor(Math.random() * messages.length)],
                        meteor.x,
                        meteor.y,
                        meteor.color
                    );
                }
            }
        }

        function bossHit(meteor, meteorIndex) {
            // –£—Ä–æ–Ω –±–æ—Å—Å—É
            const damage = Math.floor(meteor.value * game.comboMultiplier * (meteor.isBossMeteor ? 2 : 1));
            game.bossHealth -= damage;
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
            createExplosion(meteor.x, meteor.y, '#ff0000', meteor.size * 3);
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —á–∏—Å–ª–∞ —É—Ä–æ–Ω–∞
            showDamageNumber(meteor.x, meteor.y, damage, '#ff0000');
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞
            meteors.splice(meteorIndex, 1);
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞
            createMeteor();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ—Ä—Ç–∏ –±–æ—Å—Å–∞
            if (game.bossHealth <= 0) {
                game.bossHealth = 0;
                bossDeath();
            }
        }

        // ===== –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –°–ü–û–°–û–ë–ù–û–°–¢–ï–ô =====

        function useAbility(abilityId) {
            const ability = game.abilities[abilityId];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞
            if (ability.cooldown > 0) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏
            if (game.energy < ability.cost) {
                showEffectMessage("–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –≠–ù–ï–†–ì–ò–ò!", canvas.width/2, canvas.height/2, '#ff0000');
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
            if (ability.cost > 0) {
                game.energy -= ability.cost;
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞
            ability.cooldown = getAbilityCooldown(abilityId);
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
            switch(abilityId) {
                case 'gravity':
                    activateGravity();
                    break;
                case 'shocker':
                    activateShocker();
                    break;
                case 'teleport':
                    activateTeleport();
                    break;
                case 'freeze':
                    activateFreeze();
                    break;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateAbilityUI(abilityId);
            
            // –≠—Ñ—Ñ–µ–∫—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
            showEffectMessage(getAbilityName(abilityId) + " –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!", canvas.width/2, canvas.height/2, '#00ffff');
        }

        function activateGravity() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 200;
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏
            effects.push({
                type: 'gravity',
                x: centerX,
                y: centerY,
                radius: radius,
                life: 180, // 3 —Å–µ–∫—É–Ω–¥—ã
                maxLife: 180
            });
            
            // –ü—Ä–∏—Ç—è–≥–∏–≤–∞–Ω–∏–µ –ø—É–ª—å
            bossBullets.forEach(bullet => {
                const dx = centerX - bullet.x;
                const dy = centerY - bullet.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < radius) {
                    const force = (radius - distance) / radius * 0.1;
                    bullet.vx += (dx / distance) * force;
                    bullet.vy += (dy / distance) * force;
                }
            });
            
            // –≠—Ñ—Ñ–µ–∫—Ç–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã
            for (let i = 0; i < 50; i++) {
                const angle = Math.random() * Math.PI * 2;
                const dist = Math.random() * radius;
                
                particles.push({
                    x: centerX + Math.cos(angle) * dist,
                    y: centerY + Math.sin(angle) * dist,
                    size: Math.random() * 4 + 2,
                    color: '#00ffff',
                    life: 60,
                    maxLife: 60,
                    type: 'spark',
                    vx: -Math.cos(angle) * 3,
                    vy: -Math.sin(angle) * 3
                });
            }
        }

        function activateShocker() {
            // –ü–æ–∏—Å–∫ –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤ –±–æ—Å—Å–∞
            const bossMeteors = meteors.filter(m => m.isBossMeteor);
            let destroyed = 0;
            
            // –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤ –±–æ—Å—Å–∞
            for (let i = meteors.length - 1; i >= 0; i--) {
                if (meteors[i].isBossMeteor) {
                    createExplosion(meteors[i].x, meteors[i].y, '#ffff00', 50);
                    destroyed++;
                    meteors.splice(i, 1);
                }
            }
            
            // –£—Ä–æ–Ω –±–æ—Å—Å—É –∑–∞ –∫–∞–∂–¥—ã–π —É–Ω–∏—á—Ç–æ–∂–µ–Ω–Ω—ã–π –º–µ—Ç–µ–æ—Ä–∏—Ç
            if (boss && destroyed > 0) {
                const damage = destroyed * 100 * game.comboMultiplier;
                game.bossHealth -= damage;
                
                showDamageNumber(boss.x, boss.y, damage, '#ffff00');
                createExplosion(boss.x, boss.y, '#ffff00', 100);
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç –º–æ–ª–Ω–∏–∏
            if (boss) {
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        createLightning(boss.x, boss.y, 200, '#ffff00');
                    }, i * 100);
                }
            }
            
            // –°–æ–æ–±—â–µ–Ω–∏–µ
            showEffectMessage(`–ú–ï–¢–ï–û–†–ò–¢–ù–´–ô –®–û–ö–ï–†! x${destroyed}`, canvas.width/2, 100, '#ffff00');
        }

        function activateTeleport() {
            if (meteors.length === 0) return;
            
            // –ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –≤–æ–∑–ª–µ –±–æ—Å—Å–∞
            const newX = boss ? boss.x + (Math.random() - 0.5) * 200 : canvas.width / 2;
            const newY = boss ? boss.y + 100 + Math.random() * 100 : canvas.height / 2;
            
            // –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞
            meteors.forEach(meteor => {
                // –≠—Ñ—Ñ–µ–∫—Ç —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–∞—Ä–æ–π –ø–æ–∑–∏—Ü–∏–∏
                createTeleportEffect(meteor.x, meteor.y, meteor.color);
                
                // –ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
                meteor.x = newX + (Math.random() - 0.5) * 150;
                meteor.y = newY + (Math.random() - 0.5) * 150;
                
                // –≠—Ñ—Ñ–µ–∫—Ç —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ –Ω–∞ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
                createTeleportEffect(meteor.x, meteor.y, '#00ff00');
                
                // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –±–æ—Å—Å—É
                meteor.targetX = boss ? boss.x : meteor.x;
                meteor.targetY = boss ? boss.y : meteor.y;
            });
            
            // –ó–≤—É–∫–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç
            // playSound('teleport');
        }

        function activateFreeze() {
            // –ó–∞–º–æ—Ä–æ–∑–∫–∞ –ø—É–ª—å
            bossBullets.forEach(bullet => {
                bullet.speed *= 0.2;
                bullet.color = '#00ffff';
                bullet.frozen = true;
                
                // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–º–æ—Ä–æ–∑–∫–∏
                createParticles(bullet.x, bullet.y, '#00ffff', 5);
            });
            
            // –ó–∞–º–æ—Ä–æ–∑–∫–∞ –±–æ—Å—Å–∞
            if (boss) {
                boss.speed *= 0.3;
                boss.attackTimer = Math.max(0, boss.attackTimer - 30);
                boss.frozen = true;
                
                // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–º–æ—Ä–æ–∑–∫–∏ –Ω–∞ –±–æ—Å—Å–µ
                createExplosion(boss.x, boss.y, '#00ffff', boss.width);
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–¥—è–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü
            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 6 + 2,
                    color: '#00ffff',
                    life: 120,
                    maxLife: 120,
                    type: 'spark',
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2
                });
            }
            
            // –¢–∞–π–º–µ—Ä —Ä–∞–∑–º–æ—Ä–æ–∑–∫–∏
            setTimeout(() => {
                bossBullets.forEach(bullet => {
                    if (bullet.frozen) {
                        bullet.speed *= 5;
                        bullet.frozen = false;
                    }
                });
                
                if (boss && boss.frozen) {
                    boss.speed *= 3.33;
                    boss.frozen = false;
                }
            }, 2000);
        }

        // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

        function createExplosion(x, y, color, size = 30) {
            // –û—Å–Ω–æ–≤–Ω–æ–π –≤–∑—Ä—ã–≤
            for (let i = 0; i < size; i++) {
                particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * size/5 + 2,
                    color: color,
                    life: 60,
                    maxLife: 60,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10
                });
            }
            
            // –í—Ç–æ—Ä–∏—á–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã
            for (let i = 0; i < size/2; i++) {
                particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * size/10 + 1,
                    color: '#ffffff',
                    life: 30,
                    maxLife: 30,
                    vx: (Math.random() - 0.5) * 15,
                    vy: (Math.random() - 0.5) * 15,
                    type: 'spark'
                });
            }
        }

        function createParticles(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * 4 + 1,
                    color: color,
                    life: 30,
                    maxLife: 30,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8
                });
            }
        }

        function createTeleportEffect(x, y, color) {
            // –ö–æ–ª—å—Ü–∞ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
            for (let i = 0; i < 3; i++) {
                const ringSize = 20 + i * 20;
                
                effects.push({
                    type: 'shield',
                    x: x,
                    y: y,
                    radius: ringSize,
                    color: color,
                    life: 20,
                    maxLife: 20
                });
            }
            
            // –ß–∞—Å—Ç–∏—Ü—ã —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
            for (let i = 0; i < 20; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 5 + 2;
                
                particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * 3 + 1,
                    color: color,
                    life: 40,
                    maxLife: 40,
                    type: 'trail',
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed
                });
            }
        }

        function createLightning(x, y, length, color) {
            const points = [];
            points.push({ x: x, y: y });
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–ª–Ω–∏–∏
            let currentX = x;
            let currentY = y;
            const segments = 10;
            const segmentLength = length / segments;
            
            for (let i = 0; i < segments; i++) {
                currentY += segmentLength;
                currentX += (Math.random() - 0.5) * 50;
                points.push({ x: currentX, y: currentY });
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–æ–ª–Ω–∏–∏
            effects.push({
                type: 'lightning',
                points: points,
                color: color,
                life: 10,
                maxLife: 10
            });
            
            // –ß–∞—Å—Ç–∏—Ü—ã –≤–¥–æ–ª—å –º–æ–ª–Ω–∏–∏
            points.forEach(point => {
                createParticles(point.x, point.y, color, 3);
            });
        }

        function showDamageNumber(x, y, value, color) {
            damageNumbers.push({
                x: x,
                y: y,
                value: Math.floor(value),
                color: color,
                size: 24 + Math.min(value / 100, 16),
                life: 60,
                maxLife: 60,
                vy: -2
            });
        }

        function showCombo(combo) {
            const comboElement = document.createElement('div');
            comboElement.className = 'comboCounter';
            comboElement.textContent = `COMBO x${combo}!`;
            comboElement.style.position = 'absolute';
            comboElement.style.top = '50%';
            comboElement.style.left = '50%';
            comboElement.style.transform = 'translate(-50%, -50%)';
            
            document.getElementById('gameContainer').appendChild(comboElement);
            
            setTimeout(() => {
                comboElement.remove();
            }, 1000);
        }

        function showEffectMessage(text, x, y, color) {
            damageNumbers.push({
                x: x,
                y: y,
                value: text,
                color: color,
                size: 28,
                life: 90,
                maxLife: 90,
                vy: -1
            });
        }

        function showBossIntro() {
            bossIntro.style.display = 'block';
            
            setTimeout(() => {
                bossIntro.style.display = 'none';
            }, 3000);
        }

        function phaseChanged() {
            // –£—Å–∏–ª–µ–Ω–∏–µ –±–æ—Å—Å–∞
            if (boss) {
                boss.speed += 0.5;
                boss.phase = game.phase;
                
                // –û—Å–æ–±—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –¥–ª—è —Ñ–∞–∑—ã
                switch(game.phase) {
                    case 2:
                        boss.shield = true;
                        boss.shieldTimer = 300;
                        showEffectMessage("–§–ê–ó–ê 2: –ê–ö–¢–ò–í–ò–†–û–í–ê–ù –©–ò–¢!", canvas.width/2, 150, '#00ffff');
                        break;
                    case 3:
                        boss.speed *= 1.5;
                        showEffectMessage("–§–ê–ó–ê 3: –ë–ï–®–ï–ù–ê–Ø –°–ö–û–†–û–°–¢–¨!", canvas.width/2, 150, '#ff0000');
                        break;
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            document.getElementById('phaseDisplay').textContent = game.phase;
            document.getElementById('phaseNumber').textContent = game.phase;
            
            // –≠—Ñ—Ñ–µ–∫—Ç —Å–º–µ–Ω—ã —Ñ–∞–∑—ã
            createExplosion(canvas.width/2, canvas.height/2, '#ff00ff', 100);
        }

        function bossDeath() {
            game.bossActive = false;
            
            // –û–≥—Ä–æ–º–Ω—ã–π –≤–∑—Ä—ã–≤
            createExplosion(boss.x, boss.y, '#ff0000', 200);
            
            // –í–∑—Ä—ã–≤—ã –ø–æ —Ü–µ–ø–æ—á–∫–µ
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * boss.width;
                    createExplosion(
                        boss.x + Math.cos(angle) * distance,
                        boss.y + Math.sin(angle) * distance,
                        '#ffff00',
                        50
                    );
                }, i * 100);
            }
            
            // –°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–µ
            showEffectMessage("–ë–û–°–° –£–ù–ò–ß–¢–û–ñ–ï–ù!", canvas.width/2, canvas.height/2, '#ffff00');
            
            // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                endGame(true);
            }, 3000);
        }

        function updateUI() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            document.getElementById('meteorsDestroyed').textContent = game.meteorsDestroyed;
            document.getElementById('meteorCountNum').textContent = meteors.length;
            document.getElementById('phaseDisplay').textContent = game.phase;
            document.getElementById('phaseNumber').textContent = game.phase;
            
            // –ó–¥–æ—Ä–æ–≤—å–µ –±–æ—Å—Å–∞
            const healthPercent = (game.bossHealth / game.maxBossHealth) * 100;
            document.getElementById('bossHealthPercent').textContent = Math.floor(healthPercent);
            document.getElementById('bossHealthFill').style.width = `${healthPercent}%`;
            
            // –≠–Ω–µ—Ä–≥–∏—è
            document.getElementById('energyValue').textContent = game.energy;
            document.getElementById('energyFill').style.width = `${(game.energy / game.maxEnergy) * 100}%`;
            
            // –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
            updateAbilityUI('gravity');
            updateAbilityUI('shocker');
            updateAbilityUI('teleport');
            updateAbilityUI('freeze');
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
            if (game.score > game.highScore) {
                game.highScore = game.score;
                localStorage.setItem('meteorHighScore', game.highScore);
            }
        }

        function updateAbilityUI(abilityId) {
            const ability = game.abilities[abilityId];
            const button = document.getElementById(`ability${getAbilityIndex(abilityId)}`);
            
            if (!button) return;
            
            if (ability.cooldown > 0) {
                button.classList.add('cooldown');
                button.setAttribute('data-cooldown', Math.ceil(ability.cooldown / 60));
                button.disabled = true;
            } else {
                button.classList.remove('cooldown');
                button.removeAttribute('data-cooldown');
                button.disabled = game.energy < ability.cost;
            }
            
            button.className = `abilityBtn ${button.disabled ? 'disabled' : ''} ${ability.cooldown > 0 ? 'cooldown' : ''}`;
        }

        function updateAbilityCooldowns() {
            for (const [id, ability] of Object.entries(game.abilities)) {
                if (ability.cooldown > 0) {
                    ability.cooldown--;
                }
            }
        }

        function getAbilityIndex(id) {
            const map = { gravity: 1, shocker: 2, teleport: 3, freeze: 4 };
            return map[id] || 1;
        }

        function getAbilityCooldown(id) {
            const cooldowns = {
                gravity: 300,  // 5 —Å–µ–∫—É–Ω–¥
                shocker: 600,  // 10 —Å–µ–∫—É–Ω–¥
                teleport: 300, // 5 —Å–µ–∫—É–Ω–¥
                freeze: 450    // 7.5 —Å–µ–∫—É–Ω–¥
            };
            return cooldowns[id] || 300;
        }

        function getAbilityName(id) {
            const names = {
                gravity: "–ì–†–ê–í–ò–¢–ê–¶–ò–Ø",
                shocker: "–®–û–ö–ï–†",
                teleport: "–¢–ï–õ–ï–ü–û–†–¢",
                freeze: "–ó–ê–ú–û–†–û–ó–ö–ê"
            };
            return names[id] || "–°–ü–û–°–û–ë–ù–û–°–¢–¨";
        }

        // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô =====

        function setupCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            console.log(`Canvas —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${canvas.width}x${canvas.height}`);
        }

        function startGame() {
            console.log('üéÆ –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã...');
            
            startScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            gameOverScreen.style.display = 'none';
            
            initGame();
        }

        function endGame(victory) {
            game.running = false;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
            document.getElementById('finalMeteors').textContent = game.meteorsDestroyed;
            document.getElementById('finalTime').textContent = Math.floor(game.gameTime / 60);
            document.getElementById('finalPhase').textContent = game.phase;
            document.getElementById('gameOverTitle').textContent = victory ? 
                "üéâ –ü–û–ë–ï–î–ê! –ë–û–°–° –£–ù–ò–ß–¢–û–ñ–ï–ù!" : 
                "üíÄ –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê";
            
            gameScreen.style.display = 'none';
            gameOverScreen.style.display = 'flex';
        }

        function returnToMenu() {
            gameOverScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        }

        // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô =====

        window.addEventListener('resize', setupCanvas);

        canvas.addEventListener('click', (e) => {
            if (!game.running) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤
            meteors.forEach(meteor => {
                meteor.targetX = x + (Math.random() - 0.5) * 100;
                meteor.targetY = y + (Math.random() - 0.5) * 100;
            });
            
            // –≠—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞
            createParticles(x, y, '#ffffff', 5);
            
            // –ö–æ–º–±–æ –∑–∞ –±—ã—Å—Ç—Ä—ã–µ –∫–ª–∏–∫–∏
            const now = Date.now();
            if (now - game.lastClick < 200) { // 200ms –¥–ª—è –∫–æ–º–±–æ
                game.combo++;
                game.comboMultiplier = 1 + (game.combo * 0.1);
                game.comboTime = now;
            }
            game.lastClick = now;
        });

        canvas.addEventListener('touchstart', (e) => {
            if (!game.running) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            meteors.forEach(meteor => {
                meteor.targetX = x + (Math.random() - 0.5) * 100;
                meteor.targetY = y + (Math.random() - 0.5) * 100;
            });
            
            createParticles(x, y, '#ffffff', 5);
        });

        // –ö–Ω–æ–ø–∫–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
        document.getElementById('ability1').addEventListener('click', () => useAbility('gravity'));
        document.getElementById('ability2').addEventListener('click', () => useAbility('shocker'));
        document.getElementById('ability3').addEventListener('click', () => useAbility('teleport'));
        document.getElementById('ability4').addEventListener('click', () => useAbility('freeze'));

        // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', startGame);
        document.getElementById('menuBtn').addEventListener('click', returnToMenu);
        document.getElementById('helpBtn').addEventListener('click', () => {
            alert(`üéÆ –ö–ê–ö –ò–ì–†–ê–¢–¨:

‚Ä¢ –ö–ª–∏–∫–∞–π—Ç–µ –ø–æ —ç–∫—Ä–∞–Ω—É - –º–µ—Ç–µ–æ—Ä–∏—Ç—ã –ª–µ—Ç—è—Ç —Ç—É–¥–∞
‚Ä¢ –£–Ω–∏—á—Ç–æ–∂–∞–π—Ç–µ –º–µ—Ç–µ–æ—Ä–∏—Ç—ã –±–æ—Å—Å–∞
‚Ä¢ –°–æ–±–∏—Ä–∞–π—Ç–µ —ç–Ω–µ—Ä–≥–∏—é (–∂—ë–ª—Ç—ã–µ —Ü–∏—Ñ—Ä—ã)
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É)
‚Ä¢ –ü—Ä–æ–π–¥–∏—Ç–µ 3 —Ñ–∞–∑—ã –±–æ—Å—Å–∞

üíé –°–ü–û–°–û–ë–ù–û–°–¢–ò:
1. –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è (10 —ç–Ω–µ—Ä–≥–∏–∏) - –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç –ø—É–ª–∏
2. –®–æ–∫–µ—Ä (50 —ç–Ω–µ—Ä–≥–∏–∏) - —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç –º–µ—Ç–µ–æ—Ä–∏—Ç—ã –±–æ—Å—Å–∞
3. –¢–µ–ª–µ–ø–æ—Ä—Ç (5—Å –∫—É–ª–¥–∞—É–Ω) - —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç–µ–æ—Ä–∏—Ç—ã
4. –ó–∞–º–æ—Ä–æ–∑–∫–∞ (30 —ç–Ω–µ—Ä–≥–∏–∏) - –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—Ä–∞–≥–æ–≤

‚ö° –ö–û–ú–ë–û –°–ò–°–¢–ï–ú–ê:
–ë—ã—Å—Ç—Ä—ã–µ –∫–ª–∏–∫–∏ –¥–∞—é—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å —É—Ä–æ–Ω–∞!

–£–¥–∞—á–∏ –≤ –∏–≥—Ä–µ! üöÄ`);
        });

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            if (!game.running) return;
            
            switch(e.key) {
                case '1':
                case 'q':
                    useAbility('gravity');
                    break;
                case '2':
                case 'w':
                    useAbility('shocker');
                    break;
                case '3':
                case 'e':
                    useAbility('teleport');
                    break;
                case '4':
                case 'r':
                    useAbility('freeze');
                    break;
                case ' ':
                    // –ê–≤—Ç–æ-–∞—Ç–∞–∫–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É
                    meteors.forEach(meteor => {
                        meteor.targetX = canvas.width / 2;
                        meteor.targetY = canvas.height / 2;
                    });
                    break;
                case 'Escape':
                    returnToMenu();
                    break;
            }
        });

        // ===== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ =====

        function gameLoop() {
            if (!game.running) return;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            updateGame();
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawBackground();
            drawEffects();
            drawParticles();
            drawBullets();
            drawMeteors();
            drawBoss();
            drawDamageNumbers();
            
            requestAnimationFrame(gameLoop);
        }

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====

        console.log('üöÄ –ú–µ—Ç–µ–æ—Ä–∏—Ç–Ω—ã–π –ú—è—Ç–µ–∂ v2.0 –∑–∞–≥—Ä—É–∂–µ–Ω!');
        console.log('üëæ –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –∫ –∫–æ—Å–º–æ—Å—É –∏ —Ö–∞–æ—Å—É');
        console.log('üí° –°–æ–≤–µ—Ç—ã: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–∏—Ñ—Ä—ã 1-4 –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setupCanvas();
            console.log('‚úÖ –ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É!');
        });

    </script>
</body>
</html>
